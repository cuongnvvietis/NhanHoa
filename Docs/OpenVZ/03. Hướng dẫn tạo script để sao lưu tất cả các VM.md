# Script Backup Tất Cả VM Đang Chạy Trên OpenVZ

Script này giúp bạn sao lưu tất cả các VM đang chạy trên OpenVZ vào thư mục `/backup`.

## Yêu cầu
- OpenVZ đã được cài đặt và cấu hình.
- Thư mục `/backup` có sẵn trên máy chủ để lưu trữ bản sao lưu.
- Quyền truy cập `root` hoặc người dùng có quyền sao lưu dữ liệu hệ thống.

## Bước 1: Tạo Thư Mục Lưu Trữ Sao Lưu
Đảm bảo rằng thư mục `/backup` tồn tại trên máy chủ. Nếu chưa có, tạo nó bằng lệnh sau:

```bash
mkdir -p /backup
```
## Bước 2: Tạo Script Sao Lưu
Tạo file script mới để sao lưu VM. Chúng ta sẽ đặt tên là backup_all_vms.sh.
```
nano /root/scripts/backup_all_vms.sh
```
## Bước 3: Thêm Nội Dung Script
Dán đoạn mã sau vào file backup_all_vms.sh:
```
#!/bin/bash

# Thư mục lưu trữ bản sao lưu
BACKUP_DIR="/backup"

# Lấy danh sách tất cả các VM đang chạy
VM_LIST=$(vzlist -H -o veid -s veid)

# Kiểm tra thư mục sao lưu
if [ ! -d "$BACKUP_DIR" ]; then
    mkdir -p "$BACKUP_DIR"
fi

# Duyệt qua từng VM và sao lưu
for VM_ID in $VM_LIST; do
    echo "Đang sao lưu VM $VM_ID..."
    vzdump --compress --dumpdir "$BACKUP_DIR" "$VM_ID"
    
    if [ $? -eq 0 ]; then
        echo "Sao lưu VM $VM_ID thành công!"
    else
        echo "Lỗi khi sao lưu VM $VM_ID"
    fi
done

echo "Quá trình sao lưu hoàn tất!"
```
## Bước 4: Cấp Quyền Thực Thi cho Script
Cấp quyền thực thi cho script để có thể chạy nó:

```
chmod +x /root/scripts/backup_all_vms.sh
```
## Bước 5: Thực Thi Script
Chạy script để sao lưu tất cả các VM:

```
./backup_all_vms.sh
```
Giải Thích Các Lệnh Trong Script
vzlist -H -o veid -s veid: Lấy danh sách các ID của tất cả VM đang chạy.

vzdump --compress --dumpdir "$BACKUP_DIR" "$VM_ID": Sao lưu từng VM với ID tương ứng vào thư mục /backup và nén file sao lưu.

if [ $? -eq 0 ]: Kiểm tra trạng thái thực thi của lệnh sao lưu, nếu thành công sẽ hiển thị thông báo.
