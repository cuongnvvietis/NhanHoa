
# C·∫•u H√¨nh PHP-FPM Cho Apache2

S·ª≠ d·ª•ng PHP-FPM v·ªõi Apache mang l·∫°i hi·ªáu nƒÉng cao h∆°n so v·ªõi `mod_php` do PHP-FPM ch·∫°y c√°c process ri√™ng bi·ªát.

---

## **1. C√†i ƒê·∫∑t PHP-FPM v√† Apache**

1. **C√†i ƒë·∫∑t Apache:**
   ```bash
   sudo apt update
   sudo apt install -y apache2
   ```

2. **C√†i ƒë·∫∑t PHP v√† PHP-FPM:**
   V√≠ d·ª•, c√†i ƒë·∫∑t PHP 8.1:
   ```bash
   sudo apt install -y php8.1 php8.1-fpm php8.1-mysql
   ```

3. **Kh·ªüi ƒë·ªông PHP-FPM:**
   ```bash
   sudo systemctl start php8.1-fpm
   sudo systemctl enable php8.1-fpm
   sudo systemctl status php8.1-fpm
   ```

---

## **2. C√†i ƒê·∫∑t Module Apache H·ªó Tr·ª£ PHP-FPM**

1. **C√†i ƒë·∫∑t v√† k√≠ch ho·∫°t c√°c module c·∫ßn thi·∫øt:**
   ```bash
   sudo apt install -y libapache2-mod-fcgid
   sudo a2enmod proxy_fcgi setenvif
   sudo a2enconf php8.1-fpm
   ```

2. **Kh·ªüi ƒë·ªông l·∫°i Apache:**
   ```bash
   sudo systemctl restart apache2
   ```

3. **Ki·ªÉm tra c·∫•u h√¨nh module:**
   ```bash
   apache2ctl -M | grep fcgid
   ```

---

## **3. C·∫•u H√¨nh VirtualHost Cho PHP-FPM**

1. **M·ªü file c·∫•u h√¨nh VirtualHost m·∫∑c ƒë·ªãnh:**
   ```bash
   sudo nano /etc/apache2/sites-available/000-default.conf
   ```

2. **Ch·ªânh s·ª≠a n·ªôi dung:**
   ```apache
   <VirtualHost *:80>
       ServerName example.com
       DocumentRoot /var/www/html

       <FilesMatch \.php$>
           SetHandler "proxy:unix:/run/php/php8.1-fpm.sock|fcgi://localhost/"
       </FilesMatch>

       ErrorLog ${APACHE_LOG_DIR}/error.log
       CustomLog ${APACHE_LOG_DIR}/access.log combined
   </VirtualHost>
   ```

3. **L∆∞u file v√† tho√°t (Ctrl + O, Enter, Ctrl + X).**

---

## **4. T·∫°o File PHP Ki·ªÉm Tra**

1. **T·∫°o file `index.php` trong th∆∞ m·ª•c web:**
   ```bash
   echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/index.php
   ```

2. **C·∫•p quy·ªÅn truy c·∫≠p:**
   ```bash
   sudo chown -R www-data:www-data /var/www/html
   sudo chmod -R 755 /var/www/html
   ```

3. **Kh·ªüi ƒë·ªông l·∫°i Apache:**
   ```bash
   sudo systemctl restart apache2
   ```

4. **Truy c·∫≠p ki·ªÉm tra:**
   - M·ªü tr√¨nh duy·ªát v√† truy c·∫≠p: `http://<IP ho·∫∑c domain>/index.php`.
   - B·∫°n s·∫Ω th·∫•y trang th√¥ng tin PHP (`phpinfo()`).

---

## **5. V√≠ D·ª• C·∫•u H√¨nh Cho Nhi·ªÅu Domain**

N·∫øu b·∫°n mu·ªën c·∫•u h√¨nh PHP-FPM cho nhi·ªÅu domain ho·∫∑c ·ª©ng d·ª•ng, m·ªói ·ª©ng d·ª•ng c√≥ th·ªÉ ch·∫°y v·ªõi phi√™n b·∫£n PHP ri√™ng:

1. **T·∫°o file c·∫•u h√¨nh cho domain m·ªõi:**
   ```bash
   sudo nano /etc/apache2/sites-available/example2.com.conf
   ```

2. **Th√™m n·ªôi dung sau:**
   ```apache
   <VirtualHost *:80>
       ServerName example2.com
       DocumentRoot /var/www/example2.com

       <FilesMatch \.php$>
           SetHandler "proxy:unix:/run/php/php7.4-fpm.sock|fcgi://localhost/"
       </FilesMatch>

       ErrorLog ${APACHE_LOG_DIR}/example2_error.log
       CustomLog ${APACHE_LOG_DIR}/example2_access.log combined
   </VirtualHost>
   ```

3. **K√≠ch ho·∫°t VirtualHost:**
   ```bash
   sudo ln -s /etc/apache2/sites-available/example2.com.conf /etc/apache2/sites-enabled/
   sudo mkdir -p /var/www/example2.com
   echo "<?php phpinfo(); ?>" | sudo tee /var/www/example2.com/index.php
   sudo chown -R www-data:www-data /var/www/example2.com
   sudo chmod -R 755 /var/www/example2.com
   ```

4. **Kh·ªüi ƒë·ªông l·∫°i Apache:**
   ```bash
   sudo systemctl restart apache2
   ```

5. **Truy c·∫≠p ki·ªÉm tra:**
   - Th√™m `example2.com` v√†o file `/etc/hosts` (n·∫øu kh√¥ng c√≥ DNS):
     ```plaintext
     127.0.0.1 example2.com
     ```
   - Truy c·∫≠p: `http://example2.com`.

---

## **6. Ghi Ch√∫**
- **`SetHandler`**: D√≤ng n√†y x√°c ƒë·ªãnh Apache s·∫Ω g·ª≠i y√™u c·∫ßu PHP ƒë·∫øn socket c·ªßa PHP-FPM.
- **Nhi·ªÅu phi√™n b·∫£n PHP**: ƒê·∫£m b·∫£o b·∫°n ch·ªâ ƒë·ªãnh ƒë√∫ng ƒë∆∞·ªùng d·∫´n socket c·ªßa phi√™n b·∫£n PHP t∆∞∆°ng ·ª©ng (v√≠ d·ª•: `php7.4-fpm.sock` ho·∫∑c `php8.1-fpm.sock`).

N·∫øu c·∫ßn h·ªó tr·ª£ th√™m, h√£y cho t√¥i bi·∫øt! üòä
