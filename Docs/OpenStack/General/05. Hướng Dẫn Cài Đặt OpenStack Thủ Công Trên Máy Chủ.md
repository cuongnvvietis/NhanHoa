# Hướng Dẫn Cài Đặt OpenStack Thủ Công Trên Máy Chủ

## Mục lục
- [Cấu hình mạng và cài đặt tiện ích cơ bản](#cấu-hình-mạng-và-cài-đặt-tiện-ích-cơ-bản)
- [Cài đặt và cấu hình MariaDB](#cài-đặt-và-cấu-hình-mariadb)
- [Cài đặt RabbitMQ](#cài-đặt-rabbitmq)
- [Cài đặt Memcached](#cài-đặt-memcached)
- [Cài đặt etcd](#cài-đặt-etcd)
- [Cài đặt Keystone (Identity)](#cài-đặt-keystone-identity)
- [Cài đặt Glance (Image Service)](#cài-đặt-glance-image-service)
- [Cài đặt Nova (Compute Service)](#cài-đặt-nova-compute-service)
- [Cài đặt Neutron (Network Service)](#cài-đặt-neutron-network-service)
- [Cài đặt Cinder (Block Storage Service)](#cài-đặt-cinder-block-storage-service)
- [Cài đặt Horizon (Dashboard)](#cài-đặt-horizon-dashboard)

## Cấu hình mạng và cài đặt tiện ích cơ bản
1. Sửa file `/etc/hosts`:
    ```bash
    sudo vim /etc/hosts
    ```
    Xóa dòng `127.0.1.1 controller` nếu có, và thêm các dòng:
    ```
    172.16.2.9 controller
    172.16.2.10 compute1
    172.16.2.16 block1
    ```

2. Sửa file `/etc/default/grub`:
    ```bash
    sudo vim /etc/default/grub
    ```
    Thêm dòng sau vào:
    ```
    GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"
    ```
    Chạy lệnh:
    ```bash
    sudo update-grub
    sudo reboot
    ```

3. Cấu hình các giao diện mạng:
    ```bash
    sudo vim /etc/network/interfaces
    ```
    Thêm các cấu hình sau:
    ```
    auto eth0
    iface eth0 inet static
      address 172.16.2.9
      netmask 255.255.240.0
      dns-nameservers 8.8.8.8

    auto eth1
    iface eth1 inet manual
      up ip link set dev eth1 up
      down ip link set dev eth1 down

    auto eth2
    iface eth2 inet dhcp
    ```

4. Cài đặt tiện ích cơ bản:
    ```bash
    sudo apt update
    sudo apt install vim glances curl
    sudo apt upgrade -y
    ```

## Cài đặt và cấu hình MariaDB
1. Cài đặt MariaDB:
    ```bash
    sudo apt install mariadb-server python-pymysql
    ```

2. Sửa file cấu hình `/etc/mysql/mariadb.conf.d/99-openstack.cnf`:
    ```bash
    sudo vim /etc/mysql/mariadb.conf.d/99-openstack.cnf
    ```
    Thêm các dòng sau:
    ```
    [mysqld]
    bind-address = 172.16.2.9
    default-storage-engine = innodb
    innodb_file_per_table = on
    max_connections = 4096
    collation-server = utf8_general_ci
    character-set-server = utf8
    ```

3. Khởi động lại MariaDB và bảo mật:
    ```bash
    sudo service mysql restart
    sudo mysql_secure_installation
    ```

## Cài đặt RabbitMQ
1. Cài đặt RabbitMQ:
    ```bash
    sudo apt install rabbitmq-server
    ```

2. Tạo người dùng `openstack`:
    ```bash
    sudo rabbitmqctl add_user openstack openstack
    sudo rabbitmqctl set_permissions openstack ".*" ".*" ".*"
    ```

## Cài đặt Memcached
1. Cài đặt Memcached:
    ```bash
    sudo apt install memcached python-memcache
    ```

2. Cấu hình địa chỉ IP trong `/etc/memcached.conf`:
    ```bash
    sudo vim /etc/memcached.conf
    ```
    Thêm dòng sau:
    ```
    -l 172.16.2.9
    ```

3. Khởi động lại dịch vụ:
    ```bash
    sudo service memcached restart
    ```

## Cài đặt etcd
1. Tạo người dùng và thư mục cho etcd:
    ```bash
    sudo groupadd --system etcd
    sudo useradd --home-dir "/var/lib/etcd" --system --shell /bin/false -g etcd etcd
    sudo mkdir -p /etc/etcd /var/lib/etcd
    sudo chown etcd:etcd /etc/etcd /var/lib/etcd
    ```

2. Tải và cài đặt etcd:
    ```bash
    ETCD_VER=v3.2.7
    curl -L https://github.com/coreos/etcd/releases/download/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd.tar.gz
    tar xzvf /tmp/etcd.tar.gz -C /tmp --strip-components=1
    sudo cp /tmp/etcd /usr/bin/etcd
    sudo cp /tmp/etcdctl /usr/bin/etcdctl
    ```

3. Cấu hình etcd trong `/etc/etcd/etcd.conf.yml`:
    ```yaml
    name: controller
    data-dir: /var/lib/etcd
    initial-cluster-state: 'new'
    initial-cluster-token: 'etcd-cluster-01'
    initial-cluster: controller=http://172.16.2.9:2380
    initial-advertise-peer-urls: http://172.16.2.9:2380
    advertise-client-urls: http://172.16.2.9:2379
    listen-peer-urls: http://0.0.0.0:2380
    listen-client-urls: http://172.16.2.9:2379
    ```

4. Khởi động dịch vụ etcd:
    ```bash
    sudo systemctl enable etcd
    sudo systemctl start etcd
    ```

## Cài đặt Keystone (Identity)
1. Tạo cơ sở dữ liệu Keystone:
    ```bash
    sudo mysql
    CREATE DATABASE keystone;
    GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'openstack';
    GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'openstack';
    ```

2. Cài đặt Keystone:
    ```bash
    sudo apt install keystone apache2 libapache2-mod-wsgi
    ```

3. Cấu hình truy cập cơ sở dữ liệu trong `/etc/keystone/keystone.conf`:
    ```bash
    sudo crudini --set /etc/keystone/keystone.conf database connection mysql+pymysql://keystone:openstack@controller/keystone
    sudo crudini --set /etc/keystone/keystone.conf token provider fernet
    ```

4. Đồng bộ cơ sở dữ liệu Keystone:
    ```bash
    sudo keystone-manage db_sync
    ```


